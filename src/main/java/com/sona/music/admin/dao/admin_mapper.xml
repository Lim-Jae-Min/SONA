<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sona.music.admin.dao.AdminDAO">


	<update id="noticeDel" >
		UPDATE NOTICE_BOARD set notice_delete = 1 WHERE notice_idx = #{param1}
	</update>
	
	<select id="adminCheck" resultType="Integer">
		SELECT COUNT(admin_id) FROM ADMIN WHERE admin_id = #{param1}
	</select>
	
	
	<insert id = "noticeWrite"  
	useGeneratedKeys="true" 
	keyColumn="notice_idx"
	keyProperty="notice_idx"
	parameterType="com.sona.music.admin.dto.AdminDTO">
		INSERT INTO NOTICE_BOARD(
			admin_id, notice_title,notice_content,notice_delete
			)values(
			#{admin_id},#{notice_title},#{notice_content},0
			)
	</insert>
	
	<update id = "noticeUpdate"  
	useGeneratedKeys="true" 
	keyColumn="notice_idx"
	keyProperty="notice_idx"
	parameterType="com.sona.music.admin.dto.AdminDTO">
		UPDATE NOTICE_BOARD SET
			notice_title=#{notice_title},
			notice_content=#{notice_content}
			WHERE notice_idx = #{notice_idx}
	</update>
	
	<insert id="noticePhotoWrite">
		INSERT INTO PHOTO_BOARD (user_id,ori_filename,new_filename,post_idx,photo_category)
			VALUES(#{param4},#{param1},#{param2},#{param3},#{param5})
	</insert>
	
	<delete id="photoDel">
    DELETE FROM PHOTO_BOARD WHERE post_idx = #{param1} AND photo_category = #{param2} AND new_filename = #{param3}
	</delete>
	
	<insert id="adminFaqWriteDo" >
		INSERT INTO FAQ_BOARD (admin_id,faq_title,faq_answer,faq_target)
			VALUES(#{param1},#{param2},#{param3},#{param4})
	</insert>
	
	<update id = "faqEdit" parameterType="com.sona.music.admin.dto.AdminDTO">
		UPDATE FAQ_BOARD SET
			faq_title = #{faq_title},
			faq_answer = #{faq_answer},
			faq_target = #{faq_target}
			WHERE faq_idx = #{faq_idx}
	</update>
	
		<update id="faqDel" >
		UPDATE FAQ_BOARD set faq_delete = 1 WHERE faq_idx = #{param1}
	</update>
	
	
	
	<!-- admin Review List -->
	<select id="showListSearchReview" resultType="com.sona.music.admin.dto.AdminDTO">
		SELECT R.*,U.user_type FROM REVIEW R left join USERS U ON R.rater_id  = U.user_id 
			WHERE review_delete = #{param3}
			<choose>
				<when test="param6 == 1">
					<if test='param5 != null'>
					 AND
						 <if test="param5 == 2">
						 	R.review_content LIKE '%${param4}%' 
						 </if>
						<if test="param5 == 1">
							 faq_title LIKE '%${param4}%' 	
						</if> 
					</if>	
				</when>
				<when test="param6 == 2">
					AND U.user_type = "수강생"
					<if test='param5 != null'>
					 AND
						 <if test="param5 == 2">
						 	R.review_content LIKE '%${param4}%' 
						 </if>
						<if test="param5 == 1">
							 faq_title LIKE '%${param4}%' 	
						</if> 
					</if>	
				</when>
				<when test="param6 == 3">
					AND U.user_type = "강사"
					<if test='param5 != null'>
					 AND
						 <if test="param5 == 2">
						 	R.review_content LIKE '%${param4}%' 
						 </if>
						<if test="param5 == 1">
							 faq_title LIKE '%${param4}%' 	
						</if> 
					</if>	
				</when>
			</choose>	
			ORDER BY review_idx DESC LIMIT #{param1},#{param2};
	</select>
	
	<select id="allCountReview" resultType="int">
		SELECT CEIL (COUNT(faq_idx)/#{param1}) AS pages FROM FAQ_BOARD
			WHERE faq_delete = #{param2}
			<choose>
				<when test="param5 == 1">
					<if test='param4 != null'>
					 AND
						 <if test="param4 == 2">
						 	R.review_content LIKE '%${param3}%' 
						 </if>
						<if test="param4 == 1">
							 faq_title LIKE '%${param3}%' 	
						</if> 
					</if>	
				</when>
				<when test="param5 == 2">
					AND faq_target = "수강생"
					<if test='param4 != null'>
					 AND
						 <if test="param4 == 2">
						 	R.review_content LIKE '%${param3}%' 
						 </if>
						<if test="param4 == 1">
							 faq_title LIKE '%${param3}%' 	
						</if> 
					</if>	
				</when>
				<when test="param5 == 3">
					AND faq_target = "강사"
					<if test='param4 != null'>
					 AND
						 <if test="param4 == 2">
						 	R.review_content LIKE '%${param3}%' 
						 </if>
						<if test="param4 == 1">
							 faq_title LIKE '%${param3}%' 	
						</if> 
					</if>	
				</when>			
			</choose>	
	</select>
	
	
</mapper>