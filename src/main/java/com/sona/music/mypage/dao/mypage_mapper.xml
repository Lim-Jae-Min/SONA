<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sona.music.mypage.dao.MyPageDAO">

	   <select id="getUserInfo" parameterType="String" resultType="com.sona.music.mypage.dto.MyPageDTO">
    SELECT 
        u.user_name,
        u.user_type,
        u.user_id,
        u.user_email,
        u.user_phone,
        u.user_bank,
        u.user_accountnumber,
        af.applyform_inst,
        af.applyform_location,
        af.applyform_days,
        af.applyform_style,
        af.have_inst
    FROM USERS u
    LEFT JOIN (
        SELECT *
        FROM APPLICATION_FORM
        WHERE user_id = #{loginId}
        LIMIT 1
    ) af ON u.user_id = af.user_id
    WHERE u.user_id = #{loginId}
</select>
    
    <update id="updateUserInfo" parameterType="map">
        UPDATE USERS u
        INNER JOIN APPLICATION_FORM us ON u.user_id = us.user_id
        SET 
            u.user_name = #{user_name},
            u.user_pass = #{user_pass},
            u.user_email = #{user_email},
            u.user_phone = #{user_phone},
            u.user_accountnumber = #{user_accountnumber},
            u.user_bank = #{user_bank},
            us.inst_category_idx = #{instCategory},
            us.applyform_inst = #{applyform_inst},
            us.applyform_location = #{applyform_location},
            us.applyform_days = #{applyform_days},
            us.applyform_style = #{applyform_style}
        WHERE u.user_id = #{loginId}
    </update>
		
		
		<select id = "qnaList" parameterType="String" resultType="com.sona.music.mypage.dto.MyPageDTO" >
		SELECT 
		    cq.ANONYMOUS_STATUS,
		    cq.Q_TITLE,
		    CASE WHEN cq.QUESTION_IDX = ca.ANSWER_IDX THEN 'Y' ELSE 'N' END AS ANSWER_STATUS,
		    cq.Q_REG_DATE
		FROM 
		    CLASS_QUESTION cq
		LEFT JOIN 
		    CLASS_ANSWER ca ON cq.QUESTION_IDX = ca.ANSWER_IDX
		
		
		
		</select>
		


</mapper>