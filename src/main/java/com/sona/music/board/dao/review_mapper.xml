<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sona.music.board.dao.ReviewDAO">

	<select id="list" resultType="com.sona.music.board.dto.ReviewDTO">
		SELECT 
    	r.SCORE, 
    	r.REVIEW_TITLE, 
    	r.RATER_ID, 
   		 CONCAT(MIN(CH_DATE), ' ~ ', MAX(CH_DATE)) AS STUDY_DATE,
   		(SELECT COUNT(NEW_FILENAME) FROM PHOTO_BOARD p WHERE p.POST_IDX = r.REVIEW_IDX) AS img_cnt,
    	r.REVIEW_REG_DATE 
		FROM REVIEW r 
		JOIN CLASS_HISTORY ch ON r.CLASS_IDX = ch.CLASS_IDX
		GROUP BY r.REVIEW_IDX
		ORDER BY REVIEW_IDX DESC 
		LIMIT #{param1} OFFSET #{param2};
	</select>
	
	<select id="allCount" resultType="Integer">
		SELECT CEIL(COUNT(REVIEW_IDX)/#{param1}) AS pages FROM REVIEW
	</select>
	
	<insert id="write"
	useGeneratedKeys="true"
	keyColumn = "REVIEW_IDX"
	keyProperty="REVIEW_IDX"
	parameterType="com.sona.music.board.dto.ReviewDTO"
	>
	INSERT INTO REVIEW(SCORE,REVIEW_TITLE,REVIEW_CONTENT)
			VALUES(#{SCORE},#{REVIEW_TITLE},#{REVIEW_CONTENT})
	
	</insert>
	
	<insert id="fileWrite">
		INSERT INTO PHOTO_BOARD(ORI_FILENAME,NEW_FILENAME,POST_IDX,PHOTO_CATEGORY)
			VALUES(#{param1},#{param2},#{param3},#{param4})
	
	</insert>
	
	
	
	
	

</mapper>