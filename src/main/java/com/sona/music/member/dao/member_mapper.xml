<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sona.music.member.dao.MemberDAO">

	<select id="findIdEmail" resultType="String">
		SELECT USER_EMAIL FROM USERS WHERE USER_EMAIL = #{param1}
	</select>
	


	<select id="findId" resultType="String">
		SELECT USER_ID FROM USERS WHERE USER_EMAIL = #{param1}
	</select>
	
	<select id="findPw" resultType="String">
		SELECT USER_PASS FROM USERS WHERE USER_ID = #{param1} AND USER_EMAIL = #{param2}
	</select>
	
	<select id="findPwcheckId" resultType="String">
		SELECT USER_ID FROM USERS WHERE USER_ID = #{param1}
	</select>
	
	<select id="findPwEmail" resultType="String">
		SELECT USER_EMAIL FROM USERS WHERE USER_EMAIL = #{param1} AND USER_ID = #{param2}
	</select>
	
	<update id="changePw">
		UPDATE USERS SET USER_PASS = #{param2} WHERE USER_ID = #{param1}
	</update>
	
 
	<select id="login" resultType="com.sona.music.member.dto.MemberDTO">
		select 
			u.USER_ID,
			u.USER_NAME,
			u.USER_TYPE,
			CONCAT(FORMAT((SELECT (SUM(mh.manner_variance) + 36.5) 
				FROM MANNER_HISTORY mh), 2), '') AS manner,
			(SELECT sum(up.POINT) 
				FROM USER_POINT up WHERE up.user_id = u.user_id) as point
		FROM USERS u WHERE u.USER_ID = #{param1} AND u.USER_PASS = #{param2}	
	</select>
	
	<select id="overlay" resultType="int">
		SELECT COUNT(USER_ID) FROM USERS WHERE USER_ID = #{param1}
   </select>
	
	<insert id ="join" parameterType="map">
		INSERT INTO USERS(USER_ID,USER_NAME,USER_EMAIL,USER_PASS,USER_PHONE,USER_ACCOUNTNUMBER,USER_TYPE,USER_BANK)
		VALUES(#{id},#{name},#{email},#{pw},#{phone},#{accountnumber},#{usertype},#{bank})
	</insert>
	
	
	<select id="list" resultType="com.sona.music.member.dto.MemberDTO">
		SELECT 
	</select>
	
	
	
	<select id="allCount" resultType="Integer">
		SELECT CEIL(COUNT(REVIEW_IDX)/#{param1}) AS pages FROM REVIEW
	</select>
	
</mapper>	